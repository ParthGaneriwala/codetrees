public void testNegativeWeights() {
    String descr = "Incorrect handling of negative weights";
    Stats reference = getStats();
    Stats test = getStats();
    final double[] positiveWeights = { 1.0, 10.0, 2.0, 2.0, 3.0, 3.0, 4.0, 4.0, 5.0, 5.0, 10.0, 0.1, -10.0, 0.1, 100.0, 2.3, -100.0, 2.4 };
    final double[] negativeWeights = { 1.0, -10.0, 2.0, -2.0, 3.0, -3.0, 4.0, -4.0, 5.0, -5.0, 10.0, -0.1, -10.0, -0.1, 100.0, -2.3, -100.0, -2.4 };
    addWeightedStats(reference, positiveWeights);
    subtractWeightedStats(test, negativeWeights);
    reference.calculateDerived();
    test.calculateDerived();
    checkStats(test, descr, reference, 0.0);
    addWeightedStats(reference, weightedValues1);
    addWeightedStats(test, weightedValues1);
    subtractWeightedStats(reference, positiveWeights);
    addWeightedStats(test, negativeWeights);
    reference.calculateDerived();
    test.calculateDerived();
    checkStats(test, descr, reference, 0.0);
    addWeightedStats(reference, weightedValues2);
    addWeightedStats(test, weightedValues2);
    addWeightedStats(reference, positiveWeights);
    subtractWeightedStats(test, negativeWeights);
    reference.calculateDerived();
    test.calculateDerived();
    checkStats(test, descr, reference, 0.0);
    subtractWeightedStats(reference, weightedValues1);
    subtractWeightedStats(test, weightedValues1);
    reference.calculateDerived();
    test.calculateDerived();
    checkStats(test, descr, reference, 0.0);
}
