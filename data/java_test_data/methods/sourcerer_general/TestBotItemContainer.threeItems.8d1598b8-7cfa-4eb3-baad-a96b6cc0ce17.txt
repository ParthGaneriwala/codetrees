@Test
@DirtiesContext
public void threeItems() throws Exception {
    configureMinimalGame();
    Collection<DbBotItemConfig> dbBotItemConfigs = new ArrayList<DbBotItemConfig>();
    DbBotItemConfig config1 = new DbBotItemConfig();
    config1.setCount(1);
    config1.setBaseItemType(itemService.getDbBaseItemType(TEST_START_BUILDER_ITEM_ID));
    config1.setRegion(new Rectangle(2000, 2000, 2000, 2000));
    config1.setCreateDirectly(true);
    dbBotItemConfigs.add(config1);
    DbBotItemConfig config2 = new DbBotItemConfig();
    config2.setCount(2);
    config2.setBaseItemType(itemService.getDbBaseItemType(TEST_FACTORY_ITEM_ID));
    config2.setRegion(new Rectangle(2000, 2000, 2000, 2000));
    dbBotItemConfigs.add(config2);
    BotItemContainer botItemContainer = (BotItemContainer) applicationContext.getBean("botItemContainer");
    botItemContainer.init(dbBotItemConfigs);
    UserState userState = userService.getUserState(new DbBotConfig());
    Base base = baseService.createBotBase(userState, "Test Bot");
    Assert.assertFalse(botItemContainer.isFulfilled(userState));
    botItemContainer.buildup(base.getSimpleBase(), userState);
    Assert.assertEquals(1, getAllSynItemId(base.getSimpleBase(), TEST_START_BUILDER_ITEM_ID, null).size());
    Assert.assertFalse(botItemContainer.isFulfilled(userState));
    botItemContainer.buildup(base.getSimpleBase(), userState);
    waitForActionServiceDone();
    Assert.assertEquals(1, getAllSynItemId(base.getSimpleBase(), TEST_START_BUILDER_ITEM_ID, null).size());
    Assert.assertEquals(1, getAllSynItemId(base.getSimpleBase(), TEST_FACTORY_ITEM_ID, null).size());
    Assert.assertFalse(botItemContainer.isFulfilled(userState));
    botItemContainer.buildup(base.getSimpleBase(), userState);
    waitForActionServiceDone();
    Assert.assertTrue(botItemContainer.isFulfilled(userState));
    Assert.assertEquals(1, getAllSynItemId(base.getSimpleBase(), TEST_START_BUILDER_ITEM_ID, null).size());
    Assert.assertEquals(2, getAllSynItemId(base.getSimpleBase(), TEST_FACTORY_ITEM_ID, null).size());
    // Does nothing
    botItemContainer.buildup(base.getSimpleBase(), userState);
    waitForActionServiceDone();
    Assert.assertTrue(botItemContainer.isFulfilled(userState));
    Assert.assertEquals(1, getAllSynItemId(base.getSimpleBase(), TEST_START_BUILDER_ITEM_ID, null).size());
    Assert.assertEquals(2, getAllSynItemId(base.getSimpleBase(), TEST_FACTORY_ITEM_ID, null).size());
    Id id = getAllSynItemId(base.getSimpleBase(), TEST_FACTORY_ITEM_ID, null).get(0);
    killSyncItem(id);
    Assert.assertFalse(botItemContainer.isFulfilled(userState));
    botItemContainer.buildup(base.getSimpleBase(), userState);
    waitForActionServiceDone();
    Assert.assertTrue(botItemContainer.isFulfilled(userState));
    Assert.assertEquals(1, getAllSynItemId(base.getSimpleBase(), TEST_START_BUILDER_ITEM_ID, null).size());
    Assert.assertEquals(2, getAllSynItemId(base.getSimpleBase(), TEST_FACTORY_ITEM_ID, null).size());
    id = getAllSynItemId(base.getSimpleBase(), TEST_START_BUILDER_ITEM_ID, null).get(0);
    killSyncItem(id);
    id = getAllSynItemId(base.getSimpleBase(), TEST_FACTORY_ITEM_ID, null).get(0);
    killSyncItem(id);
    Assert.assertFalse(botItemContainer.isFulfilled(userState));
    botItemContainer.buildup(base.getSimpleBase(), userState);
    waitForActionServiceDone();
    Assert.assertFalse(botItemContainer.isFulfilled(userState));
    Assert.assertEquals(1, getAllSynItemId(base.getSimpleBase(), TEST_START_BUILDER_ITEM_ID, null).size());
    Assert.assertEquals(1, getAllSynItemId(base.getSimpleBase(), TEST_FACTORY_ITEM_ID, null).size());
    botItemContainer.buildup(base.getSimpleBase(), userState);
    waitForActionServiceDone();
    Assert.assertTrue(botItemContainer.isFulfilled(userState));
    Assert.assertEquals(1, getAllSynItemId(base.getSimpleBase(), TEST_START_BUILDER_ITEM_ID, null).size());
    Assert.assertEquals(2, getAllSynItemId(base.getSimpleBase(), TEST_FACTORY_ITEM_ID, null).size());
    botItemContainer.killAllItems();
    assertWholeItemCount(0);
}
