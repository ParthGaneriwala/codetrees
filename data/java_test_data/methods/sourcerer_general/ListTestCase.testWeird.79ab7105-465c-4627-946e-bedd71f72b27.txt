public void testWeird() throws Exception {
    ChromatticSessionImpl session = login();
    A3 a = session.insert(A3.class, "aaa");
    List<B3> bs = a.getChildren();
    bs.add(session.create(B3.class, "1"));
    bs.add(session.create(B3.class, "2"));
    bs.add(session.create(B3.class, "3"));
    Iterator<B3> i = a.getChildren().iterator();
    assertEquals("1", session.getName(i.next()));
    assertEquals("2", session.getName(i.next()));
    assertEquals("3", session.getName(i.next()));
    assertFalse(i.hasNext());
    session.save();
    session.close();
    session = login();
    a = session.findByPath(A3.class, "aaa");
    bs = a.getChildren();
    bs.remove(0);
    bs.remove(0);
    i = a.getChildren().iterator();
    assertEquals("3", session.getName(i.next()));
    assertFalse(i.hasNext());
    session.save();
    session.close();
    session = login();
    a = session.findByPath(A3.class, "aaa");
    bs = a.getChildren();
    B3 foo = session.create(B3.class, "4");
    bs.add(foo);
    i = a.getChildren().iterator();
    assertEquals("3", session.getName(i.next()));
    assertEquals("4", session.getName(i.next()));
    assertFalse(i.hasNext());
    session.save();
    session.close();
}
