@Test
@DirtiesContext
public void bot() throws Exception {
    configureMinimalGame();
    System.out.println("**** bot ****");
    beginHttpSession();
    beginHttpRequestAndOpenSessionInViewFilter();
    DbBotConfig dbBotConfig = setupMinimalBot(new Rectangle(4000, 4000, 3000, 3000));
    endHttpRequestAndOpenSessionInViewFilter();
    endHttpSession();
    waitForBotToBuildup(dbBotConfig);
    beginHttpSession();
    beginHttpRequestAndOpenSessionInViewFilter();
    Assert.assertEquals(1, baseService.getBases().size());
    Assert.assertEquals(4, baseService.getBases().get(0).getItems().size());
    Assert.assertTrue(baseService.getBases().get(0).getUserState().isBot());
    Assert.assertEquals(0, userService.getAllUserStates().size());
    Assert.assertEquals(1, userService.getAllBotUserStates().size());
    mgmtService.backup();
    endHttpRequestAndOpenSessionInViewFilter();
    endHttpSession();
    beginHttpSession();
    beginHttpRequestAndOpenSessionInViewFilter();
    assertBackupSummery(1, 4, 1, 1);
    List<BackupSummary> backupSummaries = mgmtService.getBackupSummary();
    mgmtService.restore(backupSummaries.get(0).getDate());
    Assert.assertEquals(1, baseService.getBases().size());
    Assert.assertTrue(baseService.getBases().get(0).getUserState().isBot());
    Assert.assertEquals(0, userService.getAllUserStates().size());
    Assert.assertEquals(1, userService.getAllBotUserStates().size());
    Assert.assertEquals(4, baseService.getBases().get(0).getItems().size());
    endHttpRequestAndOpenSessionInViewFilter();
    endHttpSession();
    beginHttpSession();
    beginHttpRequestAndOpenSessionInViewFilter();
    mgmtService.backup();
    endHttpRequestAndOpenSessionInViewFilter();
    endHttpSession();
    beginHttpSession();
    beginHttpRequestAndOpenSessionInViewFilter();
    assertBackupSummery(2, 4, 1, 1);
    backupSummaries = mgmtService.getBackupSummary();
    mgmtService.restore(backupSummaries.get(0).getDate());
    Assert.assertEquals(1, baseService.getBases().size());
    Assert.assertTrue(baseService.getBases().get(0).getUserState().isBot());
    Assert.assertEquals(0, userService.getAllUserStates().size());
    Assert.assertEquals(1, userService.getAllBotUserStates().size());
    Assert.assertEquals(4, baseService.getBases().get(0).getItems().size());
    endHttpRequestAndOpenSessionInViewFilter();
    endHttpSession();
}
